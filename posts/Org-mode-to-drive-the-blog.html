<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Org mode to drive the blog</title>
<!-- 2015-05-22 Fri 08:28 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Boris Buliga &lt;d12frosted@icloud.com&gt;" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel='stylesheet' type='text/css' href='/css/default.css' />
<link rel='stylesheet' href='/font-awesome/css/font-awesome.min.css'>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<header>
  <ul class='nav-list'>
    <li class='nav-elem nav-left nav-head'>
      <a href='/'><i class='fa fa-home'></i> d12frosted</a>
    </li>
    <li class='nav-elem nav-left nav-head'>
      <a href='/archive.html'><i class='fa fa-archive'></i> Archive</a>
    </li>
    <li class='nav-elem nav-left nav-head'>
      <a href='/updates.html'><i class='fa fa-refresh'></i> Latest Updates</a>
    </li>
    <li class='nav-elem nav-right'>
      <a href='http://stackoverflow.com/users/3086454/d12frosted'><i class='fa fa-stack-overflow'></i> StackOverflow</a>
    </li>
    <li class='nav-elem nav-right'>
      <a href='https://github.com/d12frosted'><i class='fa fa-github'></i> GitHub</a>
    </li>
  </ul>
</header>
</div>
<div id="content">
<h1 class="title">Org mode to drive the blog</h1>
<p>
Over the last months I have totally switched to <code>org-mode</code>. I am using it to track things I need to do, to keep a diary and write different kind of notes. I like a lot of things about <code>org-mode</code>, but I am going to tell you only about one nice feature I started to use recently - <code>org-mode</code> as a static blog generator.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Preface</a>
<ul>
<li><a href="#sec-1-1">Why <code>org-mode</code>?</a></li>
</ul>
</li>
<li><a href="#sec-2">Configurations</a>
<ul>
<li><a href="#sec-2-1">Structure</a></li>
<li><a href="#sec-2-2">Project definition</a></li>
<li><a href="#sec-2-3">Simple implementation</a>
<ul>
<li><a href="#sec-2-3-1">Posts project</a></li>
<li><a href="#sec-2-3-2">Static files</a></li>
<li><a href="#sec-2-3-3">Index page</a></li>
<li><a href="#sec-2-3-4">The Blog</a></li>
<li><a href="#sec-2-3-5">Next steps</a></li>
</ul>
</li>
<li><a href="#sec-2-4">More features</a>
<ul>
<li><a href="#sec-2-4-1">Recursive property and more static files</a></li>
<li><a href="#sec-2-4-2">Custom head</a></li>
<li><a href="#sec-2-4-3">Some default <code>css</code></a></li>
<li><a href="#sec-2-4-4">Code highlighting</a></li>
<li><a href="#sec-2-4-5">Preamble and Postamble</a></li>
<li><a href="#sec-2-4-6">Validation link</a></li>
<li><a href="#sec-2-4-7">Site map</a></li>
<li><a href="#sec-2-4-8">Shrink <code>org-publish-project-alist</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">Afterwords</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Preface</h2>
<div class="outline-text-2" id="text-1">
<p>
<i>You can skip this section without any impact on your understanding of the topic.</i>
</p>

<p>
I am hosting my blog at <a href="https://pages.github.com">GitHub Pages</a> service. It has support of <a href="http://jekyllrb.com">Jakyll</a>, but instead of it I wanted to use <a href="http://jaspervdj.be/hakyll/">Hakyll</a> - a <a href="https://www.haskell.org">Haskell</a> library for generating static sites. And for a long time (like 5 posts) I was a happy <code>Hakyll</code> user. I was until I realized that it's easy to generate my blog using <a href="http://orgmode.org">Org mode</a> - emacs mode for keeping notes, maintaining TODO lists, planning projects and other cool things. It also has great exporting options.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Why <code>org-mode</code>?</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Mostly because of it's features. I mean, features that work like a charm. And even if something doesn't work - you have a lisp for that <del>(to break everything)</del>. But for me it never was so simple.
</p>

<p>
For a long time (even hard to be accurate, but I am sure that for more than 2 years) I was storing all my notes in <code>markdown</code> files. At the beginning my flow was very stubborn. After some time of learning programming I thought that I could simplify my flow by creating a tool to manage my notes. So I created a really useful tool for my needs that was solving only one thing - note organization. My idea was very simple - all tools I was using before were trying to combine three different tasks in one tool: organization, editing and viewing. And usually at least one of those aspects suffered very much. For me it's usually an editing part. But I also hated that such tools are forcing me to use their understanding of what note is. I don't want to say that I have a special meaning for note, no. Just can't say that it's always the same. So I created <code>KitsuneBook</code>. While I was designing it, I always kept in mind the vision of a big box where I store old letters, notes, photos and some other strange stuff. The primal idea of <code>KitsuneBook</code> is that the note is an abstract thing.. So for <code>KitsuneBook</code> a note is just a black box with attached configuration file that is used to decide how to read and how to edit it. Simple.
</p>

<p>
I was experimenting with <code>KitsuneBook</code> very much. I even was planning to integrate Evernote (mostly because of it's syncing features) and git for versioning. But at one point I just moved to <code>org-mode</code>. Mostly because <code>markdown</code> wasn't enough for me. And also because <code>org-mode</code> offered so much great features that I couldn't resist. At the first month I was trying to use <code>KitsuneBook</code> but then I realized that despite all the good things it gave me I just don't need it anymore. Damn you emacs. But don't get me wrong. I am not even mad. I am amazed on how good emacs at combining and fusing different tools. And making the result available from few key presses.
</p>

<p>
So I started to take all my notes in <code>org</code> files. <code>Hakyll</code> uses <a href="http://pandoc.org">pandoc</a> to convert different files to <code>html</code>. And <code>pandoc</code> is capable of converting <code>org</code> files as well. So the story might end up here. But I wasn't satisfied by three things.
</p>

<p>
The first one is pretty simple. <code>Hakyll</code> doesn't know a thing about <code>org</code> properties. So you need to duplicate some information in a special header (<code>YAML</code> front matter?). It actually don't bother me very much, because I don't use it heavily, but duplicating tittle was pissing me off.
</p>

<p>
The second one is much more serious. I don't like duplicating content on my computer. For all my notes I have a working directory. Blog posts are nothing more than regular notes. I am just sharing them. So I like having blog posts in my working directory as well. But for <code>hakyll</code> (and it's not <code>hakyll</code>'s fault) I was copying specific parts of note into the blog post (because almost every note has some reference parts, todos etc - and I don't want to share this data with anyone). But I often update my notes after some time, so every time I update something, I need to remove old blog post and create new one or just move all changes. Just annoying.
</p>

<p>
So the third thing. When you convert <code>org</code> file using <code>pandoc</code> you actually don't have much control over export process. Well, honestly you do, but you need to hack <code>pandoc</code> sources for this. And why would you do this, when you have <code>org-mode</code> that offers you a lot of control over this process without much effort? After all, if you want (and you should) checkout <code>pandoc</code> sources, you don't need to mess with <code>org</code> files for it, right?
</p>

<p>
So I checked some tutorials and now I publish my blog from <code>org-mode</code> without any of mentioned problems. Just keep in mind that this solution worked for, but it doesn't mean that it will work for you. In case something is not clear in my explanations - feel free to ask me!
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Configurations</h2>
<div class="outline-text-2" id="text-2">
<div class="figure">
<img src="../images/1431793228-org1.png" alt="Leuven theme is making you jealous">
<p class="caption">Leuven theme is making you jealous</p>
</div>

<p>
In <code>org-mode</code> you can export a single file. I bet you have already tried it. But in case you haven't - just press <code>C-c C-e</code> to run <code>org-export-dispatch</code>. In case you're confused by what you saw - press <code>h o</code>. It will export current <code>org</code> file as <code>html</code> file and open it in your default browser. <code>org-mode</code> also allows you to export several files at the same time. In order to do so you need to configure a project. A project is a pair of files and their exporting configurations. So actually, your blog is also a project. We just need to specify it's files and some exporting rules.
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Structure</h3>
<div class="outline-text-3" id="text-2-1">
<p>
My blog has following structure. It's a bit simplified, but anyway.
</p>

<pre class="example">
.
├── css
│   └── ...
├── drafts
    └── ...
├── images
│   └── ...
├── index.org
├── js
│   └── ...
└── posts
    └── ...
</pre>

<p>
Pretty simple, isn't it? Looks just like an usual site.
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Project definition</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Project is defined by specifying it's name and property values.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #008000;">"project-name"</span> <span style="color: #006FE0;">:property</span> value <span style="color: #006FE0;">:property</span> value ...<span style="color: #707183;">)</span>
</pre>
</div>

<p>
It's also possible to define project as a composition of other projects.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #008000;">"project-name"</span> <span style="color: #006FE0;">:components</span> <span style="color: #7388D6;">(</span><span style="color: #008000;">"project-1"</span> <span style="color: #008000;">"project-2"</span> ...<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
In order to do so - you need to define some regular projects first. For example.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"project-1"</span> <span style="color: #006FE0;">:property</span> value <span style="color: #006FE0;">:property</span> value ...<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"project-2"</span> <span style="color: #006FE0;">:property</span> value <span style="color: #006FE0;">:property</span> value ...<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"project-name"</span> <span style="color: #006FE0;">:components</span> <span style="color: #709870;">(</span><span style="color: #008000;">"project-1"</span> <span style="color: #008000;">"project-2"</span> ...<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
In my case I have four projects:
</p>

<ol class="org-ol">
<li>project for posts
</li>
<li>project for other pages (like archive and index)
</li>
<li>project for static files (like images, css and js files)
</li>
<li>blog - a combination of all previous projects
</li>
</ol>

<p>
If you think about - it makes sense. Static files have different exporting options comparing to posts. As for distinguishing posts and some other pages - it's not necessary, but you might want to do it as well. Read further to see why.
</p>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Simple implementation</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Let's start by making things simple. In case you're interested in full solution - skip this part totally or just checkout my latest <a href="https://github.com/d12frosted/environment/blob/master/emacs/configs/org-configs.el">configurations</a>.
</p>
</div>

<div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1">Posts project</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
So let's define a project for posts.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"blog-posts"</span>
         <span style="color: #006FE0;">:base-directory</span> <span style="color: #008000;">"~/blog-sources/posts/"</span>       <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where posts are stored</span>
         <span style="color: #006FE0;">:base-extension</span> <span style="color: #008000;">"org"</span>                         <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">extension of files you are going to publish</span>
                                                       <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">"org" is a default value, so you can omit it</span>
         <span style="color: #006FE0;">:publishing-directory</span> <span style="color: #008000;">"~/blog/posts/"</span>         <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where to publish your posts</span>
         <span style="color: #006FE0;">:publishing-function</span> org-html-publish-to-html <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">function to publish with</span>
       <span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
It's pretty straightforward. <code>org-mode</code> will search for files with <code>:base-extension</code> in a <code>:base-directory</code> and will use <code>:publishing-function</code> to publish them in <code>:publishing-directory</code>. You can try it right now, by calling <code>org-publish</code> and picking up <code>blog-posts</code> project. <code>org-html-publish-to-html</code> is a function you use to convert <code>org</code> files into <code>html</code> files.
</p>
</div>
</div>

<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2">Static files</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
Probably you have some images in your posts. So let's publish them as well. Just remember that you should link them from posts by using relative links like <code>../images/img-name.png</code> or absolute links. My point is - beware of broken links!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"blog-posts"</span> ... <span style="color: #909183;">)</span>                          <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-posts</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-static-files"</span>
         <span style="color: #006FE0;">:base-directory</span> <span style="color: #008000;">"~/blog-sources/images/"</span>    <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where images are stored</span>
         <span style="color: #006FE0;">:base-extension</span> <span style="color: #008000;">"png</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">jpg</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">gif"</span>           <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">images extensions</span>
         <span style="color: #006FE0;">:publishing-directory</span> <span style="color: #008000;">"~/blog/images/"</span>      <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where to move (publish) images</span>
         <span style="color: #006FE0;">:publishing-function</span> org-publish-attachment <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">function to publish with</span>
        <span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
So we see few differences. Firstly, <code>:base-extension</code> is actually regular expression, so you can specify a lot of different extensions. Just don't forget to omit the dot! Secondly, we are using <code>org-publish-attachment</code> to publish matched files. This function just moves matched files to <code>:publishing-directory</code>.
</p>

<p>
So now you can publish this project as well. What about css and js files? Let's delay until we start using them. Then we'll just update these configurations.
</p>
</div>
</div>

<div id="outline-container-sec-2-3-3" class="outline-4">
<h4 id="sec-2-3-3">Index page</h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
Every blog needs an index page. At least for the list of all posts, right? <code>Org-mode</code> can generate this list for you automatically, but let's start with something very simple.  Just create an <code>index.org</code> file in <code>\~/blog-sources</code>. You can use whatever content you want. If you wish, add some links to your posts (<code>org</code> files) and they will be converted into right links to <code>html</code> files automatically.
</p>

<p>
So let's create a project for this one simple file.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"blog-posts"</span> ... <span style="color: #909183;">)</span>        <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-posts</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-static-files"</span> ... <span style="color: #909183;">)</span> <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-static-files</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-pages"</span>
         <span style="color: #006FE0;">:base-directory</span> <span style="color: #008000;">"~/blog-sources/"</span>
         <span style="color: #006FE0;">:publishing-function</span> org-html-publish-to-html
         <span style="color: #006FE0;">:publishing-directory</span> <span style="color: #008000;">"~/blog/"</span>
        <span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
As you can see, at this point is pretty similar to <code>blog-posts</code> project. Just other directories and omitted extension (because <code>org</code> is the default value for <code>:base-extension</code>).
</p>
</div>
</div>

<div id="outline-container-sec-2-3-4" class="outline-4">
<h4 id="sec-2-3-4">The Blog</h4>
<div class="outline-text-4" id="text-2-3-4">
<p>
And the last project is our blog itself.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"blog-posts"</span> ... <span style="color: #909183;">)</span>        <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-posts</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-static-files"</span> ... <span style="color: #909183;">)</span> <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-static-files</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-pages"</span> ... <span style="color: #909183;">)</span>        <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-pages</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog"</span>
         <span style="color: #006FE0;">:components</span> <span style="color: #709870;">(</span><span style="color: #008000;">"blog-posts"</span>
                      <span style="color: #008000;">"blog-static-files"</span>
                      <span style="color: #008000;">"blog-pages"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Now you can <code>M-x &lt;return&gt; org-publish</code> and chose <code>blog</code> to publish all projects. Actually, you don't need to define the last project if you are going to publish it via <code>C-c C-e P a</code> because it will publish all your projects. But knowing this way of defining projects will not hurt.
</p>
</div>
</div>

<div id="outline-container-sec-2-3-5" class="outline-4">
<h4 id="sec-2-3-5">Next steps</h4>
<div class="outline-text-4" id="text-2-3-5">
<p>
At this point you are familiar with some publishing basics and you are free to sail. The good link to follow up from this point is the <a href="http://orgmode.org/manual/Publishing.html">official manual on publishing</a>. Also a good thing to do is to read the documentation for <code>org-publish-project-alist</code> to find more properties to setup.
</p>

<p>
But in case you are interested in more complicated (and real-life) examples, keep reading!
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">More features</h3>
<div class="outline-text-3" id="text-2-4">
</div><div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1">Recursive property and more static files</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
As we discussed before - your site might contain different static files (like images, css and js files). Previously we already defined a project for static files, but it was publishing only images from <code>images</code> folder. So you might thought that you need to define several projects for different kind of static files even despite the fact that <code>:base-extensions</code> is actually a regexp. I mean, in case you want to store different kind of static files in different directories. But a good thing - you can use <code>:recursive</code> property. So let's update our <code>blog-static-files</code> project configurations.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"blog-posts"</span> ... <span style="color: #909183;">)</span>                           <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-posts</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-static-files"</span>
         <span style="color: #006FE0;">:base-directory</span> <span style="color: #008000;">"~/blog-sources/"</span>            <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where images are stored</span>
         <span style="color: #006FE0;">:base-extension</span> <span style="color: #008000;">"png</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">jpg</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">gif</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">css</span><span style="color: #008000; font-weight: bold;">\\</span><span style="color: #008000; font-weight: bold;">|</span><span style="color: #008000;">js"</span> <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">images extensions</span>
         <span style="color: #006FE0;">:publishing-directory</span> <span style="color: #008000;">"~/blog/"</span>              <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where to move (publish) images</span>
         <span style="color: #006FE0;">:publishing-function</span> org-publish-attachment  <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">function to publish with</span>
         <span style="color: #006FE0;">:recursive</span> t                                 <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">search for files recursively</span>
        <span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-pages"</span> ... <span style="color: #909183;">)</span>                           <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-pages</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog"</span> ... <span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>                               <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog</span><span style="color: #8D8D84; font-style: italic;">' project</span>
</pre>
</div>

<p>
So now we ask to search for files with <code>:base-extension</code> in blog sources root directory (<code>:base-directory</code>) instead of images directory, we add <code>css</code> and <code>js</code> extensions to <code>:base-extension</code> regexp, change <code>:publishing-directory</code> to blog root. And it all should be done recursively. So basically it will move all matched files to the blog root preserving their relative path. I mean, <code>~/blog-sources/css/default.css</code> will be moved to <code>~/blog/css/default.css</code>.
</p>
</div>
</div>

<div id="outline-container-sec-2-4-2" class="outline-4">
<h4 id="sec-2-4-2">Custom head</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
OK, we know how to publish css files. But how can one attach them? Suppose you have a file <code>default.css</code> in <code>css</code> directory. And you want it to be loaded for all post pages. You have two options. First is to add html head property to all org files.
</p>

<div class="org-src-container">

<pre class="src src-org"><span style="color: #008ED1; background-color: #EAEAFF;">#+HTML_HEAD: &lt;link rel="stylesheet" type="text/css" href="/css/default.css" /&gt;</span>
</pre>
</div>

<p>
But it's really bad solution. We want it to be attached automatically. So you have a second solution - setting <code>:html_head</code> property in project settings.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"blog-posts"</span>
         <span style="color: #006FE0;">:base-directory</span> <span style="color: #008000;">"~/blog-sources/posts/"</span>       <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where posts are stored</span>
         <span style="color: #006FE0;">:base-extension</span> <span style="color: #008000;">"org"</span>                         <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">extension of files you are going to publish</span>
                                                       <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">"org" is a default value, so you can omit it</span>
         <span style="color: #006FE0;">:publishing-directory</span> <span style="color: #008000;">"~/blog/posts/"</span>         <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where to publish your posts</span>
         <span style="color: #006FE0;">:publishing-function</span> org-html-publish-to-html <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">function to publish with</span>
         <span style="color: #006FE0;">:html_head</span> <span style="color: #008000;">"&lt;link rel='stylesheet' type='text/css' href='/css/default.css' /&gt;"</span>
        <span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-static-files"</span> ... <span style="color: #909183;">)</span>                     <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-static-files</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-pages"</span> ... <span style="color: #909183;">)</span>                            <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-pages</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog"</span> ... <span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>                                <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog</span><span style="color: #8D8D84; font-style: italic;">' project</span>
</pre>
</div>

<p>
But remember that <code>:html_head</code> is just a string. So you can also add some js files there along with css files:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"blog-posts"</span>
         <span style="color: #006FE0;">:base-directory</span> <span style="color: #008000;">"~/blog-sources/posts/"</span>       <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where posts are stored</span>
         <span style="color: #006FE0;">:base-extension</span> <span style="color: #008000;">"org"</span>                         <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">extension of files you are going to publish</span>
                                                       <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">"org" is a default value, so you can omit it</span>
         <span style="color: #006FE0;">:publishing-directory</span> <span style="color: #008000;">"~/blog/posts/"</span>         <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where to publish your posts</span>
         <span style="color: #006FE0;">:publishing-function</span> org-html-publish-to-html <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">function to publish with</span>
         <span style="color: #006FE0;">:html_head</span> <span style="color: #008000;">"</span>
<span style="color: #008000;">&lt;link rel='stylesheet' type='text/js' href='/css/default.css' /&gt;</span>
<span style="color: #008000;">&lt;script src='/js/script.js'&gt;&lt;/script&gt;</span>
<span style="color: #008000;">"</span>
        <span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-static-files"</span> ... <span style="color: #909183;">)</span>                     <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-static-files</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-pages"</span> ... <span style="color: #909183;">)</span>                            <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-pages</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog"</span> ... <span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>                                <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog</span><span style="color: #8D8D84; font-style: italic;">' project</span>
</pre>
</div>

<p>
You also might want to add this <code>:html_head</code> to <code>blog-pages</code> project as well.
</p>

<p>
First thing to notice - it's getting a bit ugly and we are starting to copying and pasting. We will improve things soon.
</p>

<p>
Second thing to notice - all links I am using are absolute to site root. I mean, link like <code>/css/default.css</code>. It's static site, yes, but with such links you can't run it without a server, because links will be broken. I am using <code>wai</code> and <code>warp</code> to test my site locally.
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #808080;">{-# LANGUAGE NoImplicitPrelude #-}</span>
<span style="color: #808080;">{-# LANGUAGE OverloadedStrings #-}</span>

<span style="color: #0000FF;">module</span> <span style="color: #6434A3;">Main</span> <span style="color: #0000FF;">where</span>

<span style="color: #0000FF;">import</span> <span style="color: #6434A3;">BasicPrelude</span>
<span style="color: #0000FF;">import</span> <span style="color: #6434A3;">Network.Wai</span>
<span style="color: #0000FF;">import</span> <span style="color: #6434A3;">Network.Wai.Application.Static</span>
<span style="color: #0000FF;">import</span> <span style="color: #6434A3;">Network.Wai.Handler.Warp</span>

<span style="color: #006699;">main</span> <span style="color: #006699;">::</span> <span style="color: #6434A3;">IO</span> <span style="color: #707183;">()</span>
<span style="color: #006699;">main</span> <span style="color: #006699;">=</span> run <span style="color: #D0372D;">8000</span> app

<span style="color: #006699;">app</span> <span style="color: #006699;">::</span> <span style="color: #6434A3;">Application</span>
<span style="color: #006699;">app</span> <span style="color: #006699;">=</span> staticApp <span style="color: #BA36A5;">$</span> defaultFileServerSettings <span style="color: #008000;">"/Users/d12frosted/Developer/d12frosted.github.io/"</span>
</pre>
</div>

<p>
It looks a bit noisy, but actually it's very simple. Also I am using this because I usually have installed <code>wai</code> and <code>warp</code> so it doesn't require any additional work from me. You can use <code>node</code> or whatever else you like. It's just testing the result.
</p>

<p>
And the last thing I wanted to notice. Actually, you have two properties for header: <code>HTML_HEAD</code> and <code>HTML_HEAD_EXTRA</code>. I recommend you to use one of them in project configurations and leave the other for any additional head stuff that you would like to add for specific files. For example, you would like to add <code>MathJax</code> to only one specific post. You can do it by adding following line to the top of your org file.
</p>

<div class="org-src-container">

<pre class="src src-org"><span style="color: #008ED1; background-color: #EAEAFF;">#+HTML_HEAD_EXTRA: &lt;script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'&gt;&lt;/script&gt;</span>
</pre>
</div>

<p>
Use the same property when you want to override the default one!.
</p>
</div>
</div>

<div id="outline-container-sec-2-4-3" class="outline-4">
<h4 id="sec-2-4-3">Some default <code>css</code></h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
Probably you already have noticed that <code>org-mode</code> attaches some <code>css</code> to published files. But for some of you it might be undesirable. To get rid off those <code>css</code> you need to configure <code>org-html-head-include-default-style</code> variable, or set <code>:html-head-include-default-style</code> property for projects you wish to come clean. The default value is <code>t</code>, so just change that to <code>nil</code>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"blog-posts"</span>
         <span style="color: #006FE0;">:base-directory</span> <span style="color: #008000;">"~/blog-sources/posts/"</span>       <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where posts are stored</span>
         <span style="color: #006FE0;">:base-extension</span> <span style="color: #008000;">"org"</span>                         <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">extension of files you are going to publish</span>
                                                       <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">"org" is a default value, so you can omit it</span>
         <span style="color: #006FE0;">:publishing-directory</span> <span style="color: #008000;">"~/blog/posts/"</span>         <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">directory where to publish your posts</span>
         <span style="color: #006FE0;">:publishing-function</span> org-html-publish-to-html <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">function to publish with</span>
         <span style="color: #006FE0;">:html_head</span> <span style="color: #008000;">"</span>
<span style="color: #008000;">&lt;link rel='stylesheet' type='text/js' href='/css/default.css' /&gt;</span>
<span style="color: #008000;">&lt;script src='/js/script.js'&gt;&lt;/script&gt;</span>
<span style="color: #008000;">"</span>
         <span style="color: #006FE0;">:html-head-include-default-style</span> nil
        <span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-static-files"</span> ... <span style="color: #909183;">)</span>                     <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-static-files</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog-pages"</span> ... <span style="color: #909183;">)</span>                            <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog-pages</span><span style="color: #8D8D84; font-style: italic;">' project</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"blog"</span> ... <span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>                                <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">configurations for `</span><span style="color: #D0372D; font-style: italic;">blog</span><span style="color: #8D8D84; font-style: italic;">' project</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-4-4" class="outline-4">
<h4 id="sec-2-4-4">Code highlighting</h4>
<div class="outline-text-4" id="text-2-4-4">
<p>
When your file is published (exported), by default all code code snippets are exported with some syntax highlighting. It might be handy, but you might want more control over the colors. By default <code>org-mode</code> inlines <code>css</code> for code. It uses your font settings, so basically your theme affects generated <code>css</code>. You can make it more generic by setting <code>org-html-htmlize-output-type</code> to <code>css</code> (the default is <code>inline-css</code>). It asks <code>org-mode</code> to export <code>css</code> selectors only. As far as I know, you can't set it on per-project basis.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-html-htmlize-output-type 'inline-css<span style="color: #707183;">)</span> <span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">default</span>
<span style="color: #707183;">(</span>setq org-html-htmlize-output-type 'css<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-4-5" class="outline-4">
<h4 id="sec-2-4-5">Preamble and Postamble</h4>
<div class="outline-text-4" id="text-2-4-5">
<p>
Just a common thing - you want to put some html block before and after generated body in every file in project. For example, you want to see navigation bar and footer with some links on every post page. You really could just insert some <code>#+BEGIN_HTML</code> in every file, but it will be hell to update something. You also could move it to separate files and just <code>#+INCLUDE</code> them in every file, but hey. Isn't it bad anyway? And here comes a good thing - you can set configure preamble and postamble globally or on per-project basis. First, make sure that <code>org-html-preamble</code> and <code>org-html-postamble</code> are set to <code>t</code> (this default). Sure, you can set any of them to nil if you don't want it to be included to generated <code>html</code> files.
</p>

<p>
Variables you are interested in are <code>org-html-preamble-format</code> (<code>:html-preamble</code> property) and <code>org-html-postamble-format</code> (<code>:html-postamble</code> property). This format string can contain these elements:
</p>

<ul class="org-ul">
<li><code>%t</code> – title.
</li>
<li><code>%a</code> – author's name
</li>
<li><code>%e</code> – author's email
</li>
<li><code>%d</code> – date
</li>
<li><code>%c</code> – <code>org-html-creator-string</code>
</li>
<li><code>%v</code> – <code>org-html-validation-link</code>
</li>
<li><code>%T</code> – export time
</li>
<li><code>%C</code> – last modification time
</li>
</ul>

<p>
For example, as a postamble I use following string.
</p>

<pre class="example">
"&lt;p&gt;By %a&lt;\p&gt;&lt;p&gt;Created on %d&lt;\p&gt;"
</pre>
</div>
</div>

<div id="outline-container-sec-2-4-6" class="outline-4">
<h4 id="sec-2-4-6">Validation link</h4>
<div class="outline-text-4" id="text-2-4-6">
<p>
Probably you already seen that 'validation' link after postamble. And I believe that you really don't need it. Just set <code>org-html-validation-link</code> to <code>nil</code> and become happy.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>setq org-html-validation-link nil<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-4-7" class="outline-4">
<h4 id="sec-2-4-7">Site map</h4>
<div class="outline-text-4" id="text-2-4-7">
<p>
<i>Under construction. Come back in few days.</i>
</p>
</div>
</div>

<div id="outline-container-sec-2-4-8" class="outline-4">
<h4 id="sec-2-4-8">Shrink <code>org-publish-project-alist</code></h4>
<div class="outline-text-4" id="text-2-4-8">
<p>
<i>Under construction. Come back in few days.</i>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Afterwords</h2>
<div class="outline-text-2" id="text-3">
<p>
I hope that you liked this post and found something useful for yourself. In case you have any questions, objections or suggestions - feel free to write me to d12frosted at icloud dot com.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>By Boris Buliga &lt;d12frosted@icloud.com&gt;<p><p>Created on <span class="timestamp-wrapper"><span class="timestamp">&lt;2015-05-11&gt;</span></span><p>
</div>
</body>
</html>
